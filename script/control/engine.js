import*as t from"../view/map.js";import*as e from"../view/sidebar.js";import*as r from"../view/hotbar.js";import*as s from"../model/unit/actor/hero/hero.js";import*as a from"../model/dungeon/dungeon.js";import*as i from"../model/point.js";import*as n from"./driver.js";import*as o from"../model/unit/actor/hero/kit.js";import*as m from"./audio.js";import*as p from"./keyboard.js";import*as f from"./spawner.js";import*as u from"./rpg.js";import*as c from"./mechanic/traversal.js";import*as d from"./mechanic/combat.js";const l=u.pick(o.kits);class h{constructor(){this.map=!1,this.power=!1,this.combat=!1,this.audio=!1,this.tick=100}reveal(o){if(this.map)for(let e of i.range(0,0,t.width,t.height))o.seen.find(o=>o.equals(e))||o.seen.push(e)}}var w=!1,g=!1,j=!1,v=!1,b=!1,k=new URL(document.location).searchParams.has("debug")&&new h;function y(o){var e,r;t.setup(),n.reset(),j&&(e=j.units.indexOf(w),j.units.splice(e,1)),(j=o).enter(w),k&&k.reveal(o);for(r of Array.from(o.seen))t.see(r.x,r.y);n.reset()}function x(){e.warn("Welcome to Loop Dungeons!"),e.warn("Press h for help.")}function L(){if(!w){if(w=new s.Hero,l.apply(w),k&&k.power)for(var o of w.gear)o.level=k.power;x(),k&&!k.audio||m.loop(m.gameplay)}y((g=new a.Dungeon).floors[0])}function O(){var o=document.location.href;if(o.indexOf("tukkek")<0&&o.indexOf("localhost")<0)throw new Error("Failed to load game assets.")}function D(){O(),k&&document.body.classList.add("debug"),t.setup(),c.setup(),m.setup(),f.setup(),L(),e.setup(),n.setup(),r.setup(),p.setup()}function P(o){v=o}function q(o){b=o}function A(){window.alert("Game over!"),w=!1,L()}function E(){w.dead&&A(),t.update(),e.update(),r.update(),d.autofight();for(var o of j.units)o.turn();e.log("")}export{w as hero,g as dungeon,j as floor,v as explore,b as fight,k as debug,y as enter,L as start,O as loadassets,D as setup,P as autoexplore,q as autofight,E as turn};