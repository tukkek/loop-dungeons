import*as t from"../view/map.js";import*as e from"../view/sidebar.js";import*as r from"../view/hotbar.js";import*as s from"../model/dungeon/dungeon.js";import*as a from"../model/point.js";import*as i from"./driver.js";import*as n from"./audio.js";import*as f from"./keyboard.js";import*as m from"./spawner.js";import*as o from"./rpg.js";import*as u from"./mechanic/traversal.js";import*as p from"./mechanic/combat.js";class d{constructor(){this.map=!0,this.power=!1,this.combat=!1,this.audio=!1,this.tick=100}reveal(o){if(this.map)for(let e of a.range(0,0,t.width,t.height))o.seen.find(o=>o.equals(e))||o.seen.push(e)}}var c=!1,l=!1,h=!1,w=!1,g=!1,v=new URL(document.location).searchParams.has("debug")&&new d;function j(o){var e,r;t.setup(),i.reset(),h&&(e=h.units.indexOf(c),h.units.splice(e,1)),(h=o).enter(c),v&&v.reveal(o);for(r of Array.from(o.seen))t.see(r.x,r.y);i.reset()}function b(){e.warn("Welcome to Loop Dungeons!"),e.warn("Press h for help.")}function y(o){if(!c){if(c=o,v&&v.power)for(var e of c.gear)e.level=v.power;b(),v&&!v.audio||n.loop(n.gameplay)}j((l=new s.Dungeon).floors[0])}function k(){var o=document.location.href;if(o.indexOf("tukkek")<0&&o.indexOf("localhost")<0)throw new Error("Failed to load game assets.")}function x(o){k(),v&&document.body.classList.add("debug"),t.setup(),u.setup(),n.setup(),m.setup(),y(o),e.setup(),i.setup(),r.setup(),f.setup()}function L(o){i.delay(!1),w=o}function O(o){g=o}function D(){window.alert("Game over!"),c=!1,y()}function P(){c.dead&&D(),t.update(),e.update(),r.update(),p.autofight();for(var o of h.units)o.turn();e.log("")}export{c as hero,l as dungeon,h as floor,w as explore,g as fight,v as debug,j as enter,y as start,k as loadassets,x as setup,L as autoexplore,O as autofight,P as turn};