import*as r from"../view/map.js";import*as e from"../view/sidebar.js";import*as t from"../view/hotbar.js";import*as s from"../view/scape.js";import*as a from"../model/dungeon/dungeon.js";import*as i from"../model/point.js";import*as o from"../model/unit/actor/hero/kit.js";import*as n from"./driver.js";import*as m from"./audio.js";import*as f from"./keyboard.js";import*as u from"./spawner.js";import*as p from"./rpg.js";import*as d from"./mechanic/traversal.js";import*as c from"./mechanic/combat.js";import*as l from"./director.js";class h{constructor(){this.map=!0,this.power=!1,this.combat=!1,this.audio=!1,this.tick=100,this.kit=!1}debug(){}fight(o){new l.Director(w,o).start()}reveal(o){if(this.map)for(let e of i.range(0,0,r.width,r.height))o.seen.find(o=>o.equals(e))||o.seen.push(e)}}var w=!1,g=!1,j=!1,v=!1,b=!1,k=new URL(document.location).searchParams.has("debug")&&new h;function x(o){var e,t;r.setup(),n.reset(),j&&(e=j.units.indexOf(w),j.units.splice(e,1)),(j=o).enter(w),k&&k.reveal(o);for(t of Array.from(o.seen))r.see(t.x,t.y);n.reset()}function y(){e.warn("Welcome to Loop Dungeons!"),e.warn("Press h for help.")}function D(o){if(!w){if(w=o,k&&k.power)for(var e of w.gear)e.level=k.power;y(),k&&!k.audio||m.loop(m.gameplay)}x((g=new a.Dungeon).floors[0])}function L(){var o=document.location.href;if(o.indexOf("tukkek")<0&&o.indexOf("localhost")<0)throw new Error("Failed to load game assets.")}function O(o){L(),k&&document.body.classList.add("debug"),r.setup(),d.setup(),m.setup(),u.setup(),D(o),e.setup(),n.setup(),t.setup(),f.setup(),s.setup(),k&&k.debug()}function P(o){v=o}function q(o){b=o}function A(){window.alert("Game over!"),window.location.reload()}function E(){w.dead&&A(),r.update(),e.update(),t.update(),c.autofight();for(var o of j.units)o.turn();e.log("")}export{w as hero,g as dungeon,j as floor,v as explore,b as fight,k as debug,x as enter,D as start,L as loadassets,O as setup,P as autoexplore,q as autofight,E as turn};