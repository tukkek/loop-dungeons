import*as i from"./engine.js";import*as a from"../model/dungeon/floor.js";import*as o from"../model/unit/chest.js";import*as t from"../model/unit/stairs.js";import*as s from"../view/map.js";import*as l from"../model/point.js";const e=new Map([[o.Chest,1],[t.Down,1]]),r=100;var n=!1;function f(){n=!1}function m(o){var t,r=new PF.Grid(s.width,s.height);for(t of l.range(0,0,s.width,s.height)){var e=i.floor.tiles[t.x][t.y];r.setWalkableAt(t.x,t.y,e==a.empty)}var n=i.hero.location;return(new PF.AStarFinder).findPath(n.x,n.y,o.x,o.y,r)}function c(){var o=i.floor,r=[];for(let t of o.units)e.get(t.constructor)&&o.visible.find(o=>o.equals(t.location))&&0!=m(t).length&&r.push(t);0!=r.length&&(r.sort((o,t)=>m(o).length-m(t).length),r.sort((o,t)=>-e.get(o.constructor)-e.get(t.constructor)),n=r[0])}function h(){var o,t;i.explore&&!a.generating&&(n||c(),n)&&(o=m(n)[1],t=i.hero.location,i.floor.move(i.hero,o[0]-t.x,o[1]-t.y),n&&n.location.equals(i.hero.location)&&f(),s.update())}function u(){setInterval(h,r)}export{f as reset,h as turn,u as setup};