import*as a from"./engine.js";import*as i from"../model/dungeon/floor.js";import*as o from"../model/actor/chest.js";import*as t from"../model/actor/stairs.js";import*as l from"../view/map.js";import*as s from"../model/point.js";const e=new Map([[o.Chest,1],[t.Down,1]]),r=100;var n=!1;function c(){n=!1}function f(o){var t,r=new PF.Grid(l.width,l.height);for(t of s.range(0,0,l.width,l.height)){var e=a.floor.tiles[t.x][t.y];r.setWalkableAt(t.x,t.y,e==i.empty)}var n=a.hero.location;return(new PF.AStarFinder).findPath(n.x,n.y,o.x,o.y,r)}function h(){var o=a.floor,r=[];for(let t of o.actors)e.get(t.constructor)&&o.visible.find(o=>o.equals(t.location))&&0!=f(t).length&&r.push(t);0!=r.length&&(r.sort((o,t)=>f(o).length-f(t).length),r.sort((o,t)=>-e.get(o.constructor)-e.get(t.constructor)),n=r[0],console.log(n.location,f(n).length))}function m(){var o,t;a.explore&&!i.generating&&(n||h(),n)&&(o=f(n)[1],console.log(o),t=a.hero.location,a.floor.move(a.hero,o[0]-t.x,o[1]-t.y),n&&n.location.equals(a.hero.location)&&c(),l.update())}function g(){setInterval(m,r)}export{c as reset,m as turn,g as setup};