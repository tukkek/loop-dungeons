import*as s from"../engine.js";import*as o from"../rpg.js";import*as r from"../../view/hotbar.js";class n{constructor(e,t,i){this.unit=e,this.message=t,this.effect=i,this.wound=!1,this.wounds=1}damage(){var e,t=this.wound;t&&(t.wounds+=this.wounds,t.wounds<0&&(t.wounds=0),""==this.message)&&(e=t.name.toLowerCase(),this.effect=t.dead?"kill":"wound",this.message=`The ${e} is ${this.effect}ed!`)}toString(){let e=this.message.split("<br>");return(e=e.map(e=>e[0]+e.slice(1).toLowerCase())).join("<br>")}}var e=!1,a=[];function l(e,t){return e.report(`The ${e} attacks!`,"attack"),e.roll(e.force)?t.roll(t.speed)?(h(t,t+" dodges... ","dodge"),t.dodge(e,t),e.dodge(e,t),!1):(e.hit(e,t)&&t.hit(e,t)&&t.damage(),!0):(h(e,e+" misses... ","miss"),!1)}function u(e){e==s.hero&&e.cool()}function c(e,t){let i=new Map([[e,0],[t,0]]);for(;i.get(e)==i.get(t);)i.set(e,e.initiative),i.set(t,t.initiative);return[e,t].sort(e=>-i.get(e))}function t(e,t){var i=c(e,t);l(e=i[0],t=i[1])||l(t,e),u(e),u(t)}function i(e=!0){if(r.active&&!r.active.cooling&&!s.fight)return!1;let t=s.hero.gear.filter(e=>!e.cooling);if(0==t.length)return r.deactivate(),!1;o.shuffle(gear),t.sort((e,t)=>e.level-t.level).reverse();var i=(t=t.filter(e=>e.level==t[0].level))[t.length-1];return i!=r.active&&(e&&(r.activate(i),r.update()),i)}function f(){e=!0}function d(){e=!1}function h(e,t,i=!1){e=new n(e,t,i);return a.push(e),e}export{e as fighting,a as reports,t as fight,i as autofight,f as start,d as end,h as report};