import*as i from"../../view/map.js";import*as o from"../../view/sidebar.js";import*as d from"../../view/hotbar.js";import*as n from"../engine.js";import*as a from"../rpg.js";function l(e,t){return!!e.roll(e.force)&&(t.roll(t.speed)?(e.dead||e.dodge(e,t),t.dead||t.dodge(e,t),!1):(!e.dead&&!e.hit(e,t)||!t.dead&&!t.hit(e,t)||e.dead||t.dead||t.damage(),!0))}function f(e){e==n.hero&&(e.cool(),t())}function u(e,t){let r=new Map([[e,0],[t,0]]);for(;r.get(e)==r.get(t);)r.set(e,e.initiative),r.set(t,t.initiative);return[e,t].sort(e=>-r.get(e))}function e(t,r){if(!r.hp)return!1;if(!n.debug||!n.debug.combat){let e=!1;for(;!e;){var a=u(t,r);(l(t=a[0],r=a[1])||t.dead||r.dead||l(r,t))&&(e=!0),f(t),f(r)}return i.update(),o.update(),d.update(),(t.dead||r.dead)&&n.turn(),!0}r.remove()}function t(e=!0){if(d.active&&!d.active.cooling&&!n.fight)return!1;let t=n.hero.gear.filter(e=>!e.cooling);if(0==t.length)return d.deactivate(),!1;a.shuffle(gear),t.sort((e,t)=>e.level-t.level).reverse();var r=(t=t.filter(e=>e.level==t[0].level))[t.length-1];return r!=d.active&&(e&&(d.activate(r),d.update()),r)}export{e as fight,t as autofight};