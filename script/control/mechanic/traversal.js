import*as f from"../engine.js";import*as o from"./combat.js";import*as r from"../director.js";import*as l from"../../model/point.js";import*as n from"../../model/unit/stairs.js";import*as s from"../../view/map.js";import*as e from"../../model/dungeon/floor.js";const t=[new l.Point(0,1),new l.Point(0,2)],i=[new l.Point(1,0),new l.Point(2,0)],a=[new l.Point(0,-1),new l.Point(0,-2)],u=[new l.Point(-1,0),new l.Point(-2,0)],d=[t,i,a,u],m="Do want to start another dungeon?\nYou will keep any progress made so far.";function c(n,o=!0){var r;!n.validate(0,0,s.width,s.height)||f.floor.wall(n.x,n.y)||(r=f.floor.seen).find(o=>o.equals(n))||(r.push(n),o&&s.see(n.x,n.y))}function w(o,n,r=!0){for(var t of l.range(-1,-1,2,2))(t=t.clone()).x+=o,t.y+=n,c(t,r);var e,i=f.floor;for(e of d)for(var a of e){if((a=a.clone()).x+=o,a.y+=n,!a.validate(0,0,s.width,s.height))break;if(i.wall(a.x,a.y))break;c(a,r)}}function h(o,n){return!!n.hp&&(f.debug&&f.debug.combat?n.remove():new r.Director(f.hero,n).start(),!0)}function p(o,n){var r=f.hero;let t=r.location.clone();t.x+=o,t.y+=n;o=f.floor;if(!t.validate(0,0,s.width,s.height)||o.tiles[t.x][t.y]==e.wall)return!1;n=o.units.find(o=>o.location.equals(t));if(n){if(h(r,n))return;if(n.activate(),f.floor!=o)return}return w((r.location=t).x,t.y),f.turn(),!0}function v(){}function g(){var o=f.floor.depth+1,o=f.dungeon.floors[o];f.enter(o)}function x(){var o=f.floor;if(0==o.depth)return window.confirm(m)?void f.start():void 0;o=f.dungeon.floors[o.depth-1];f.enter(o)}export{w as explore,p as move,v as setup,g as descend,x as ascend};