import*as f from"../engine.js";import*as r from"./combat.js";import*as l from"../../model/point.js";import*as o from"../../model/unit/stairs.js";import*as s from"../../view/map.js";import*as i from"../../model/dungeon/floor.js";const n=[new l.Point(0,1),new l.Point(0,2)],t=[new l.Point(1,0),new l.Point(2,0)],e=[new l.Point(0,-1),new l.Point(0,-2)],a=[new l.Point(-1,0),new l.Point(-2,0)],d=[n,t,e,a],u="Do want to start another dungeon?\nYou will keep any progress made so far.";function m(n,o=!0){var t;!n.validate(0,0,s.width,s.height)||f.floor.wall(n.x,n.y)||(t=f.floor.seen).find(o=>o.equals(n))||(t.push(n),o&&s.see(n.x,n.y))}function w(o,n,t=!0){for(var e of l.range(-1,-1,2,2))(e=e.clone()).x+=o,e.y+=n,m(e,t);var r,i=f.floor;for(r of d)for(var a of r){if((a=a.clone()).x+=o,a.y+=n,!a.validate(0,0,s.width,s.height))break;if(i.wall(a.x,a.y))break;m(a,t)}}function c(o,n){var t=f.hero;let e=t.location.clone();e.x+=o,e.y+=n;o=f.floor;if(!e.validate(0,0,s.width,s.height)||o.tiles[e.x][e.y]==i.wall)return!1;n=o.units.find(o=>o.location.equals(e));if(n){if(r.fight(t,n))return;if(n.activate(),f.floor!=o)return}return w((t.location=e).x,e.y),f.turn(),!0}function h(){}function p(){var o=f.floor.depth+1,o=f.dungeon.floors[o];f.enter(o)}function v(){var o=f.floor;if(0==o.depth)return window.confirm(u)?void f.start():void 0;o=f.dungeon.floors[o.depth-1];f.enter(o)}export{w as explore,c as move,h as setup,p as descend,v as ascend};