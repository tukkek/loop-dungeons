import*as e from"../model/point.js";import*as i from"../control/engine.js";import*as r from"./dressing.js";const o=32,t=document.querySelector("template#cell").content.children[0],n=new Map;var f=document.querySelector("#map"),c=Math.floor(983.7/o),p=Math.floor(.8*768/o),m=Array.from(new Array(c),()=>new Array(p));class d{constructor(e,r,o){this.x=e,this.y=r,this.view=t.cloneNode(!0),this.wall=o.wall(e,r)}get location(){return new e.Point(this.x,this.y)}draw(){this.wall||(this.view.style["background-image"]='url("assets/stages/purple/Purple_tiles.png")')}get position(){return this.view.getBoundingClientRect()}dress(){this.wall||r.dress(this)}}function u(e){var r=m[e.x][e.y].position,o=n.get(e);o.style.left=32-e.width+r.left+"px",o.style.top=32-e.height+r.top+"px"}function l(){for(var e of f.querySelectorAll("div.cell"))e.remove();for(var r of f.querySelectorAll("img"))r.remove();f.style["grid-template-columns"]=`repeat(${c},32px)`;for(let r=p-1;0<=r;r--)for(let e=0;e<c;e++){var o=new d(e,r,i.floor);(m[e][r]=o).draw(),f.appendChild(o.view)}for(var t of n.values())t.remove();n.clear();for(var l of i.floor.units){var s=document.createElement("img");s.src="assets/"+l.image,n.set(l,s),u(l),f.appendChild(s)}for(var a of Array.from(m).flatMap(e=>e))a.dress()}function s(){for(var e of m)for(var r of e)r.draw();var o,t,l=i.floor.units;for(o of n.keys())l.indexOf(o)<0&&n.get(o).remove();for(t of l)u(t)}export{f as container,c as width,p as height,l as setup,s as update};