import*as s from"../model/point.js";import*as i from"../control/engine.js";import*as e from"./dressing.js";const r=32,o=document.querySelector("template#cell").content.children[0],n=new Map;var l=document.querySelector("#map"),a=Math.floor(983.7/r),f=Math.floor(.8*768/r),d=Array.from(new Array(a),()=>new Array(f));class c{constructor(e,r){this.x=e,this.y=r,this.view=o.cloneNode(!0)}get location(){return new s.Point(this.x,this.y)}draw(){i.floor.wall(this.x,this.y)||(this.view.style["background-image"]='url("assets/stages/purple/Purple_tiles.png")')}get position(){return this.view.getBoundingClientRect()}dress(){this.wall||e.dress(this)}}function p(e){var r,o=n.get(e);o&&(r=d[e.x][e.y].position,o.style.left=32-e.width+r.left+"px",o.style.top=24-e.height+r.top+"px")}function t(r,o){var e,t;new s.Point(r,o).validate(0,0,a,f)&&!i.floor.wall(r,o)&&((e=d[r][o]).draw(),e.dress(),e=i.floor.units.find(e=>e.x==r&&e.y==o))&&((t=document.createElement("img")).src="assets/"+e.image,e.zindex&&(t.style["z-index"]=e.zindex),e==i.hero&&t.classList.add("hero"),n.set(e,t),p(e),l.appendChild(t))}function m(){for(var e of l.querySelectorAll("div.cell"))e.remove();for(var r of l.querySelectorAll("img"))r.remove();l.style["grid-template-columns"]=`repeat(${a},32px)`;for(let r=f-1;0<=r;r--)for(let e=0;e<a;e++){var o=new c(e,r,i.floor);d[e][r]=o,l.appendChild(o.view)}for(var t of n.values())t.remove();n.clear()}function u(){for(var e of d)for(let r of e)i.floor.seen.find(e=>e.x==r.x&&e.y==r.y)&&r.draw();var r,o,t=i.floor.units;for(r of n.keys()){var s,l=n.get(r);t.indexOf(r)<0?l.remove():(s=r.redraw())&&(l.src="assets/"+s)}for(o of t)p(o)}export{l as container,a as width,f as height,t as see,m as setup,u as update};