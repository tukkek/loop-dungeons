import*as t from"../model/point.js";import*as n from"../control/engine.js";import*as e from"./dressing.js";import*as s from"./sidebar.js";const o=32,r=document.querySelector("template#cell").content.children[0],l=new Map;var i=document.querySelector("#map"),a=Math.floor(983.7/o),f=Math.floor(.8*768/o),c=Array.from(new Array(a),()=>new Array(f));class d{constructor(e,o){this.x=e,this.y=o,this.view=r.cloneNode(!0)}get location(){return new t.Point(this.x,this.y)}draw(){n.floor.wall(this.x,this.y)||(this.view.style["background-image"]='url("assets/stages/purple/Purple_tiles.png")')}get position(){return this.view.getBoundingClientRect()}dress(){this.wall||e.dress(this)}}function m(e){var o,r=l.get(e);r&&(o=c[e.x][e.y].position,r.style.left=32-e.width+o.left+"px",r.style.top=24-e.height+o.top+"px",e==n.hero)&&s.lastmove&&r.setAttribute("move",s.lastmove)}function p(e){s.log("");for(var o of e.describe())s.log(o)}function u(e){var o=document.createElement("img");o.src="assets/"+e.image,e.zindex&&(o.style["z-index"]=e.zindex),e==n.hero&&o.classList.add("hero"),l.set(e,o),m(e),e.hp&&(o.onmouseenter=()=>p(e)),i.appendChild(o)}function v(o,r){var e;new t.Point(o,r).validate(0,0,a,f)&&!n.floor.wall(o,r)&&((e=c[o][r]).draw(),e.dress(),e=n.floor.units.find(e=>e.x==o&&e.y==r))&&u(e)}function h(){for(var e of i.querySelectorAll("div.cell"))e.remove();for(var o of i.querySelectorAll("img"))o.remove();i.style["grid-template-columns"]=`repeat(${a},32px)`;for(let o=f-1;0<=o;o--)for(let e=0;e<a;e++){var r=new d(e,o,n.floor);c[e][o]=r,i.appendChild(r.view)}for(var t of l.values())t.remove();l.clear()}function g(e,o){e.hp?(o.src="assets/enemies/Despawn.gif",setTimeout(()=>o.remove(),300)):o.remove()}function y(){for(var e of c)for(let o of e)n.floor.seen.find(e=>e.x==o.x&&e.y==o.y)&&o.draw();var o,r,t=n.floor.units;for(o of l.keys()){var s,i=l.get(o);t.indexOf(o)<0?g(o,i):(s=o.redraw())&&(i.src="assets/"+s)}for(r of t)m(r)}export{i as container,a as width,f as height,v as see,h as setup,y as update};