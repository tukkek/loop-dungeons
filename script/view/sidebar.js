import*as e from"./map.js";import*as t from"./help.js";import*as o from"./hotbar.js";import*as c from"../control/engine.js";import*as r from"../control/mechanic/traversal.js";import*as n from"../control/mechanic/combat.js";import*as i from"../model/unit/chest.js";import*as l from"../model/unit/stairs.js";const s=document.querySelector("#sidebar"),a=s.querySelector("#messages"),u=s.querySelector("#interact"),m=s.querySelector("#explore"),f=s.querySelector("#fight"),h=s.querySelector("#climb"),g=s.querySelectorAll("#bag .item img"),p=Array.from(s.querySelectorAll("#hp span")).slice(1,6),d=Array.from(s.querySelectorAll("#xp span")).slice(1,6);function y(e){e.classList.add("active")}function q(e){e.classList.remove("active")}function S(e){y(e),setTimeout(()=>q(e),200)}function v(e,t,o){S(o.target),c.explore?b(!1):r.move(e,t)}function b(e){(e?y:q)(m),c.autoexplore(e)}function k(e){(e?y:q)(f),c.autofight(e),n.autofight()}function x(t,o){for(let e=1;e<=5;e++)e<=o?t[e-1].classList.add("full"):t[e-1].classList.remove("full")}function j(e=!1){e&&S(u);var t=c.floor.units;let o=c.hero.location;var t=t.find(e=>e instanceof i.Chest&&e.location.equals(o)),r=(u.querySelector("img").src=t?"assets/"+t.loot.image:"",u.classList);t?r.add("looting"):r.remove("looting"),e&&(t?t.grab():N("Nothing to loot here..."))}function L(){var t=c.hero;x(p,5-t.wounds),x(d,t.xp),j();for(let e=0;e<g.length;e++){var o=t.bag[e],r=g[e];r.src=o?"../assets/"+o.image:"",r.title=o?o.name:""}}function A(){var e=a.getBoundingClientRect().height;a.style["max-height"]=e+"px"}function w(){S(h);let t=c.hero.location;var e=c.floor.units.find(e=>e instanceof l.Stairs&&t.equals(e));e?e.climb():N("No stairs here...")}function C(e){e&&e.use()&&c.turn()}function E(){s.classList.remove("hidden"),s.querySelector("#north").onclick=e=>v(0,1,e),s.querySelector("#east").onclick=e=>v(1,0,e),s.querySelector("#south").onclick=e=>v(0,-1,e),s.querySelector("#west").onclick=e=>v(-1,0,e),s.querySelector("#help").onclick=e=>t.overlay(e),m.onclick=e=>b(!c.explore),f.onclick=e=>k(!c.fight),u.onclick=e=>j(!0),h.onclick=e=>w();for(let e=0;e<g.length;e++)g[e].onclick=()=>C(c.hero.bag[e]);t.setup(),L(),A()}function N(e){let t=!1;return e.trim()?(t=document.createElement("p")).textContent=e:t=document.createElement("br"),a.append(t),a.scrollTo(0,a.scrollHeight),t}function T(e){N(e).classList.add("warning")}export{y as activate,q as deactivate,S as flash,b as explore,k as fight,L as update,E as setup,N as log,T as warn};