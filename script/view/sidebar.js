import*as e from"./map.js";import*as t from"./help.js";import*as o from"./hotbar.js";import*as i from"../control/engine.js";import*as r from"../control/mechanic/traversal.js";import*as n from"../control/mechanic/combat.js";import*as c from"../model/unit/chest.js";import*as l from"../model/unit/stairs.js";const s=document.querySelector("#sidebar"),a=s.querySelector("#messages"),u=s.querySelector("#interact"),m=s.querySelector("#explore"),f=s.querySelector("#fight"),g=s.querySelector("#climb"),h=s.querySelectorAll("#bag .item img"),p=Array.from(s.querySelectorAll("#hp span")).slice(1,6),d=Array.from(s.querySelectorAll("#xp span")).slice(1,6);var y=!1;function q(e){e.classList.add("active")}function v(e){e.classList.remove("active")}function S(e){q(e),setTimeout(()=>v(e),200)}function b(e,t,o){n.fighting||(y=o.target.id,S(o.target),i.explore?k(!1):r.move(e,t))}function k(e){n.fighting||((e?q:v)(m),i.autoexplore(e))}function x(e){(e?q:v)(f),i.autofight(e)}function j(t,o){for(let e=1;e<=5;e++)e<=o?t[e-1].classList.add("full"):t[e-1].classList.remove("full")}function L(e=!1){if(!n.fighting){e&&S(u);var o=i.floor.units;let t=i.hero.location;var o=o.find(e=>e instanceof c.Chest&&e.location.equals(t)),r=(u.querySelector("img").src=o?"assets/"+o.loot.image:"",u.classList);o?r.add("looting"):r.remove("looting"),e&&(o?o.grab():T("Nothing to loot here..."))}}function A(){var t=i.hero;j(p,5-t.wounds),j(d,t.xp),L();for(let e=0;e<h.length;e++){var o=t.bag[e],r=h[e];r.src=o?"../assets/"+o.image:"",r.title=o?o.name:""}}function w(){var e=a.getBoundingClientRect().height;a.style["max-height"]=e+"px"}function C(){if(!n.fighting){S(g);let t=i.hero.location;var e=i.floor.units.find(e=>e instanceof l.Stairs&&t.equals(e));e?e.climb():T("No stairs here...")}}function E(e){e&&e.use()&&i.turn()}function N(){s.classList.remove("hidden"),s.querySelector("#north").onclick=e=>b(0,1,e),s.querySelector("#east").onclick=e=>b(1,0,e),s.querySelector("#south").onclick=e=>b(0,-1,e),s.querySelector("#west").onclick=e=>b(-1,0,e),s.querySelector("#help").onclick=e=>t.overlay(e),m.onclick=e=>k(!i.explore),f.onclick=e=>x(!i.fight),u.onclick=e=>L(!0),g.onclick=e=>C();for(let e=0;e<h.length;e++)h[e].onclick=()=>E(i.hero.bag[e]);t.setup(),A(),w()}function T(e){let t=!1;return e.trim()?(t=document.createElement("p")).textContent=e:t=document.createElement("br"),a.append(t),a.scrollTo(0,a.scrollHeight),t}function B(e){T(e).classList.add("warning")}export{y as lastmove,q as activate,v as deactivate,S as flash,k as explore,x as fight,A as update,N as setup,T as log,B as warn};